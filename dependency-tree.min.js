!function(t){var e={};e=function(){function e(e,s){var i=this;i.defaultSettings={styles:{sentence:{margin:{vertical:20,horizontal:20}},atom:{minSpacing:10,rect:{padding:{horizontal:10,vertical:7},normal:{fill:"",stroke:"#999","stroke-width":1,r:4},hover:{fill:"#B5B7EA",stroke:"#7679D8"},click:{fill:"#81B6EE",stroke:"#3987DA"},underline:{fill:"#B5B7EA",stroke:"#7679D8"}},coref:{rect:{hover:{fill:"#B5B7EA",stroke:"#7679D8"},click:{fill:"#81B6EE",stroke:"#3987DA"}}},form:{normal:{fill:"#444",font:"16px Helvetica"},hover:{fill:"#FFF",font:"16px Helvetica"},click:{fill:"#FFF",font:"16px Helvetica"}},pos:{normal:{fill:"#7679D8",font:"11px Helvetica"},hover:{fill:"#7679D8",font:"11px Helvetica","font-weight":"bold"},click:{fill:"#3788DA",font:"11px Helvetica","font-weight":"bold"},spacing:1}},deprel:{normal:{fill:"#444",font:"12px Helvetica"},hover:{fill:"#7679D8",font:"12px Helvetica"},click:{fill:"#3788DA",font:"12px Helvetica"},padding:{horizontal:10},spacing:2,path:{width:1,spacing:6,normal:{stroke:"#666","arrow-end":"classic-wide-long","stroke-width":1},hover:{stroke:"#7679D8","arrow-end":"classic-wide-long","stroke-width":1.5},click:{stroke:"#3788DA","arrow-end":"classic-wide-long","stroke-width":2}}},underline:{height:10,label:{spacing:5,normal:{fill:"#7679D8",font:"7px Helvetica"},hover:{fill:"#7679D8",font:"7px Helvetica","font-weight":"bold"}},path:{spacing:10,normal:{stroke:"#666","stroke-width":1},hover:{stroke:"#7679D8","stroke-width":1.5}}},level:{height:30}},drawDelay:50},i.settings=t.extend(!0,{},i.defaultSettings,s),i.parsed=null,i.clickedElement=null,i.sentences=[],i.sentencesById={},i.callback=null,i.wasMouseScrolling=!1,i.container=t(e),i.container.click(function(){i.wasMouseScrolling||i.resetClickedElement()}),i.clear()}function s(){var t=this;t.DT.clickedElement!==t&&t.setActionStyles("hover")}function i(){var t=this,e=t.DT;e.clickedElement!==t&&(t.setActionStyles("normal"),null!==e.clickedElement&&e.clickedElement.setActionStyles("click"))}function n(t){var e=this.DT;memClickedElement=e.clickedElement,e.resetClickedElement(),memClickedElement!==this&&(this.setActionStyles("click"),e.clickedElement=this),void 0!==t&&t.stopPropagation()}return e.prototype.clear=function(){var t=this;t.parsed=null,t.clickedElement=null,t.sentences=[],t.sentencesById={},t.callback=null,t.container.empty()},e.prototype.isComplete=function(t){return t===this.parsed_sentences().length},e.prototype.runCallback=function(){"function"==typeof this.callback&&this.callback()},e.prototype.parsed_sentences=function(){return this.parsed},e.prototype.draw=function(e,s){var i=this;i.clear(),i.parsed=t.extend(!0,[],e),i.callback=s,i.isComplete(0)?i.runCallback():i.syncDrawSentence(0)},e.prototype.drawSentence=function(e,s){var i=this,n=i.parsed_sentences()[e],h=e+1,r=new function(){this.id=null,this.atoms=[],this.underlines=[],this.sortedAtoms=[],this.levels=null,this.container=null,this.raphael=null,this.svg=null,this.width=1,this.height=1,this.settings=null,this.init=function(e,s){this.id=e.id,this.container=t("<div></div>",{class:"sentence"}),this.raphael=Raphael(this.container[0],1,1),this.svg=this.container.find("svg"),this.settings=s},this.addAtom=function(t){this.atoms.push(t)},this.addUnderline=function(t){this.underlines.push(t)},this.sortingAtoms=function(t,e){if(t.isRoot())return 1;if(e.isRoot())return-1;var s=Math.abs(t.atomHead-t.atomSynId),i=Math.abs(e.atomHead-e.atomSynId);return s-i},this.getSortedAtoms=function(){return this.sortedAtoms.length>0?this.sortedAtoms:(this.sortedAtoms=this.atoms.slice(),this.sortedAtoms.sort(this.sortingAtoms),this.sortedAtoms)},this.getIntervalLevel=function(t,e,s){var i=this.getIntervalIndex(t,e,s),n=t.length;if(null!==i){var h=t[i],r=t.slice(0,i);return e>h.first&&r.push({first:h.first,last:e-1}),s<h.last&&r.push({first:s+1,last:h.last}),r=r.concat(t.slice(i+1,n))}return null},this.getIntervalIndex=function(t,e,s){for(var i=0;i<t.length;i++){var n=t[i];if(n.first<=e+1&&n.last>=s-1)return i}return null},this.addNewLevel=function(t,e){var s=this.getSortedAtoms().length,i=[];t>1&&i.push({first:1,last:t-1}),e<s&&i.push({first:e+1,last:s}),this.levels.push(i)},this.deprelLevel=function(t){for(var e=Math.min(t.atomSynId,t.atomHead),s=Math.max(t.atomSynId,t.atomHead),i=0;i<this.levels.length;i++){var n=this.getIntervalLevel(this.levels[i],e,s);if(null!==n)return this.levels[i]=n,i+1}return this.addNewLevel(e,s),this.levels.length},this.setLevels=function(){var t=this.getSortedAtoms(),e=t.length;this.levels=[[{first:1,last:e}]];for(var s=0;s<e;s++){var i=t[s];i.deprel.level=i.isRoot()?this.levels.length+1:this.deprelLevel(i)}},this.setInitialAtomsPosition=function(){for(var t=this.settings.styles.level.height+this.settings.styles.deprel.spacing,e=this.settings.styles.sentence.margin.vertical+t*(this.levels.length+1),s=0;s<this.atoms.length;s++){var i=this.atoms[s];if(i.rect.y=e,0===s)i.rect.x=this.settings.styles.sentence.margin.horizontal;else{var n=this.atoms[s-1];i.rect.x=n.rect.x+n.rect.width+this.settings.styles.atom.minSpacing}}},this.setSentenceSize=function(){var t=this.atoms[this.atoms.length-1],e=t.rect.y+t.rect.height+t.pos.height+t.pos.spacing;if(this.underlines.length>0){var s=this.underlines[this.underlines.length-1];e=s.path.y+s.path.height+s.label.height}this.width=t.rect.x+t.rect.width+this.settings.styles.sentence.margin.horizontal,this.height=e+this.settings.styles.sentence.margin.vertical},this.resize=function(){this.setSentenceSize(),this.raphael.setSize(this.width,this.height)},this.setAtomSpacingTopArcs=function(t){var e=t.deprel.width+2*t.deprel.padding.horizontal;if(e>t.rect.width){var s=e-t.rect.width;t.rect.x+=s/2;for(var i=t.atomSynId;i<this.atoms.length;i++)this.atoms[i].rect.x+=s}},this.changeDistanceAtoms=function(t,e){for(var s=this.atoms[t.atomHead-1],i=Math.abs(t.atomSynId-s.atomSynId)-1,n=e/(2*i+2),h=Math.min(t.atomSynId,s.atomSynId),r=Math.max(t.atomSynId,s.atomSynId),l=1,o=h;o<r;o++)l+=1,this.atoms[o].rect.x+=n*l,l+=1;for(l-=1,o=r;o<this.atoms.length;o++)this.atoms[o].rect.x+=n*l},this.calculatePositions=function(){var t=this.atoms.length,e=this.getSortedAtoms();this.setLevels(),this.setInitialAtomsPosition();for(var s=t-1;s>=0;s--){var i=e[s],n=i.deprel.width+2*i.deprel.padding.horizontal;if(i.isRoot())this.setAtomSpacingTopArcs(i);else{var h=this.atoms[i.atomHead-1],r=i.getArcX(i.atomHead),l=h.getArcX(i.atomSynId),o=Math.abs(r-l);if(n>o){var a=n-o;this.changeDistanceAtoms(i,a)}}}this.resize()},this.setAtomsPositions=function(){for(var t=this.atoms.length,e=0;e<t;e++){var s=this.atoms[e],i=null;s.isRoot()||(i=this.atoms[s.atomHead-1]),s.setRectPosition(),s.setFormPosition(),s.setPosPosition(),s.setDeprelPosition(i),s.setDeprelPath(i)}},this.drawUnderlines=function(){for(var t=this.underlines.length,e=0;e<t;e++)this.underlines[e].draw();this.resize()}};r.init(n,i.settings),r.container.DTScrollByDrag({mousedown:function(){i.wasMouseScrolling=!1},mousemove:function(){i.wasMouseScrolling=!0}}),i.container.append(r.container);for(var l=function(t){var e,s={};for(e=0;e<t.length;e++)s[t[e].id]=[];for(e=0;e<t.length;e++){var i=t[e];0!==i.head&&s[i.head].push(i.id)}return s}(n.atoms),o=0;o<n.atoms.length;o++){var a=n.atoms[o];i.setAtom(r,a,l[a.id])}n.hasOwnProperty("entities")&&i.setUnderlines(r,n.entities),n.hasOwnProperty("datetimes")&&i.setUnderlines(r,n.datetimes),r.calculatePositions(),r.setAtomsPositions(),r.drawUnderlines(),i.sentences.push(r),i.sentencesById[r.id]=r,!s&&r.container.offset().top+r.height>t(window).height()&&(s=!0),i.isComplete(h)?i.runCallback():s?i.asyncDrawSentence(h):i.syncDrawSentence(h)},e.prototype.syncDrawSentence=function(t){this.drawSentence(t,!1)},e.prototype.asyncDrawSentence=function(t){var e=this;setTimeout(function(){e.drawSentence(t,!0)},e.settings.drawDelay)},e.prototype.setUnderlines=function(t,e){for(var s=0;s<e.length;s++){var i=e[s];this.setUnderline(t,i)}},e.prototype.setUnderline=function(t,e){var n=new function(){this.sentence=null,this.firstIndex=null,this.lastIndex=null,this.label=null,this.path=null,this.DT=null,this.init=function(t,e){this.sentence=t,this.firstIndex=e.start_atom,this.lastIndex=e.end_atom;var s=t.settings.styles;this.label={element:null,text:e.label,normal:s.underline.label.normal,hover:s.underline.label.hover,click:s.underline.label.click,spacing:s.underline.label.spacing},this.path={x:0,y:0,width:0,height:s.underline.height,element:null,normal:s.underline.path.normal,hover:s.underline.path.hover,click:s.underline.path.click,spacing:s.underline.path.spacing}},this.setDT=function(t){this.DT=t},this.setPath=function(){var t=this.sentence.atoms[this.firstIndex],e=this.sentence.atoms[this.lastIndex];this.path.x=t.rect.x,this.path.y=t.rect.y+t.rect.height+t.pos.height+t.pos.spacing+this.path.spacing,this.path.width=e.rect.x+e.rect.width-t.rect.x,this.path.element=this.sentence.raphael.path(["M",this.path.x,this.path.y,"L",this.path.x,this.path.y+this.path.height,"L",this.path.x+this.path.width,this.path.y+this.path.height,"L",this.path.x+this.path.width,this.path.y]).attr(this.path.normal),this.setBounds(this.path)},this.setLabel=function(){var t=this.path.element.getBBox();this.label.element=this.sentence.raphael.text(0,0,this.label.text).attr(this.label.normal),this.label.element.attr({"text-anchor":"center",x:t.x+t.width/2,y:t.y+t.height+2*this.label.spacing}),this.setBounds(this.label),this.label.element.toBack(),this.label.element.hover(s,i,this,this)},this.setBounds=function(t){var e=t.element.getBBox();t.width=e.width,t.height=e.height},this.draw=function(){this.setPath(),this.setLabel()},this.setActionStyles=function(t){this.path.element.attr(this.path[t]),this.label.element.attr(this.label[t]);for(var e=this.firstIndex;e<=this.lastIndex;e++){var s=this.sentence.atoms[e],i="hover"===t?"underline":"normal";s.rect.element.attr(s.rect[i])}}};n.init(t,e),n.setDT(this),t.addUnderline(n)},e.prototype.setAtom=function(t,e,h){var r=new function(){this.sentenceId=null,this.form=null,this.surfaceForm=null,this.pos=null,this.rect=null,this.deprel=null,this.deprelPath=null,this.arcs=null,this.raphael=null,this.DT=null,this.init=function(t,e,s,i){var n=i.styles;this.sentenceId=e,this.arcs={width:0,map:{}},this.level={height:n.level.height+n.deprel.spacing},this.form={width:0,height:0,element:null,normal:n.atom.form.normal,hover:n.atom.form.hover,click:n.atom.form.click},this.pos={width:0,height:0,element:null,normal:n.atom.pos.normal,hover:n.atom.pos.hover,click:n.atom.pos.click,spacing:n.atom.pos.spacing},this.rect={x:0,y:0,width:0,height:0,element:null,normal:n.atom.rect.normal,hover:n.atom.rect.hover,click:n.atom.rect.click,underline:n.atom.rect.underline,padding:n.atom.rect.padding},this.deprel={level:0,width:0,height:0,element:null,padding:n.deprel.padding,normal:n.deprel.normal,hover:n.deprel.hover,click:n.deprel.click,spacing:n.deprel.spacing},this.deprelPath={element:null,normal:n.deprel.path.normal,hover:n.deprel.path.hover,click:n.deprel.path.click,width:n.deprel.path.width,spacing:n.deprel.path.spacing},this.coref={hover:n.atom.coref.rect.hover,click:n.atom.coref.rect.click},this.setAtomAttributes(t,s)},this.setDT=function(t){this.DT=t},this.isRoot=function(){return 0===this.atomHead},this.setSentenceRaphael=function(t){this.raphael=t},this.sortingReverse=function(t,e){return e-t},this.setArcs=function(){for(var t=[],e=[],s=0,i=0;i<this.atomDeps.length;i++){var n=this.atomDeps[i];n<this.atomSynId?t.push(n):e.push(n)}t.sort(this.sortingReverse),e.sort(this.sortingReverse),s=this.setArcWithDeps(t,s),this.arcs.map[this.atomHead]=s,s=this.setArcWithDeps(e,s+1),this.arcs.width=s*this.deprelPath.width+(s-1)*this.deprelPath.spacing},this.setArcWithDeps=function(t,e){for(var s=0;s<t.length;s++)this.arcs.map[t[s]]=e,e+=1;return e},this.createGraphicalElements=function(){this.setForm(),this.setPos(),this.setRect(),this.setDeprel()},this.getDeprelString=function(){var t=this.atomDeprel,e=this.atomSem.length;return e>0&&(t+="-"),t+this.atomSem.join("/")},this.setForm=function(){this.surfaceForm=null===this.atomForm?"Ø":this.atomForm,this.form.element=this.raphael.text(0,0,this.surfaceForm).attr(this.form.normal),this.setBounds(this.form),this.form.element.hover(s,i,this,this),this.form.element.click(n,this)},this.setFormPosition=function(){this.form.element.attr({"text-anchor":"center",x:this.rect.x+this.rect.width/2,y:this.rect.y+this.rect.height/2})},this.setPos=function(){this.pos.element=this.raphael.text(0,0,this.atomPos).attr(this.pos.normal),this.setBounds(this.pos)},this.setPosPosition=function(){this.pos.element.attr({"text-anchor":"center",x:this.rect.x+this.rect.width/2,y:this.rect.y+this.rect.height+this.pos.height/2+this.pos.spacing})},this.setRect=function(){var t=Math.max(this.form.width,this.pos.width,this.arcs.width);this.rect.element=this.raphael.rect(0,0,t+2*this.rect.padding.horizontal,this.form.height+2*this.rect.padding.vertical).attr(this.rect.normal),this.setBounds(this.rect),this.rect.element.toBack(),this.rect.element.hover(s,i,this,this),this.rect.element.click(n,this)},this.setRectPosition=function(){this.rect.element.attr({x:this.rect.x,y:this.rect.y})},this.setDeprel=function(){this.deprel.element=this.raphael.text(0,0,this.getDeprelString()).attr(this.deprel.normal),this.setBounds(this.deprel)},this.setDeprelPosition=function(t){var e=this.getArcX(this.atomHead),s=this.rect.y-this.deprel.level*this.level.height,i=e;t&&(i=(e+t.getArcX(this.atomSynId))/2),this.deprel.element.attr({"text-anchor":"center",x:i,y:s})},this.setDeprelPath=function(t){var e=this.getArcX(this.atomHead),s=this.deprel.element.getBBox(),i=["M",s.x,s.y+s.height+this.deprel.spacing,"L",s.x+s.width,s.y+s.height+this.deprel.spacing,"M",e,s.y+s.height+this.deprel.spacing,"L",e,this.rect.y];if(t){var n=t.getArcX(this.atomSynId);i=["M",n,t.rect.y,"L",n,s.y+s.height+this.deprel.spacing,"L",e,s.y+s.height+this.deprel.spacing,"L",e,this.rect.y]}this.deprelPath.element=this.raphael.path(i).attr(this.deprelPath.normal)},this.setBounds=function(t){var e=t.element.getBBox();t.width=e.width,t.height=e.height},this.setActionStyles=function(t){this.form.element.attr(this.form[t]),this.rect.element.attr(this.rect[t]),this.pos.element.attr(this.pos[t]);for(var e=0;e<this.atomDeps.length;e++){var s=this.atomDeps[e],i=this.DT.sentencesById[this.sentenceId].atoms[s-1];i.deprelPath.element.attr(this.deprelPath[t]),i.deprel.element.attr(this.deprel[t])}var n="normal"===t?this.rect[t]:this.coref[t];for(e=0;e<this.atomCorefs.length;e++){var h=this.getSentenceIdByCorefIndex(e),r=this.getAtomIdByCorefIndex(e),l=this.DT.sentences[h].atoms[r-1];l.rect.element.attr(n),l.form.element.attr(this.form[t])}},this.getArcX=function(t){var e=this.arcs.map[t];return this.rect.x+(this.rect.width-this.arcs.width)/2+e*this.deprelPath.width+e*this.deprelPath.spacing},this.getSentenceIdByCorefIndex=function(t){return this.atomCorefs[t].sentenceId},this.getAtomIdByCorefIndex=function(t){return this.atomCorefs[t].atomId},this.setAtomAttributes=function(t,e){this.atomForm=t.form,this.atomPos=t.pos,this.atomDeprel=t.deprel,this.atomHead=t.head,this.atomSynId=t.id,this.atomDeps=e,this.atomCorefs=t.corefs||[],this.atomSem=t.sem||[]}};r.init(e,t.id,h,this.settings),r.setDT(this),r.setSentenceRaphael(t.raphael),r.setArcs(),r.createGraphicalElements(),t.addAtom(r)},e.prototype.resetClickedElement=function(){var t,e=this;null!==e.clickedElement&&(t=e.clickedElement,e.clickedElement=null,i.call(t))},t.fn.DTScrollByDrag=function(e){var s,i,n,h,r=t.extend({mousedown:null,mousemove:null,mouseup:null},e),l=t(this),o=!1;return l.on({mousedown:function(t){o=!0,s=t.pageX,i=t.pageY,n=l.scrollTop(),h=l.scrollLeft(),l.css("cursor","pointer"),null!==r.mouswdown&&r.mousedown(t)}}),t(window).on({mousemove:function(t){o&&(l.scrollTop(n+(i-t.pageY)),l.scrollLeft(h+(s-t.pageX)),null!==r.mousemove&&r.mousemove(t))},mouseup:function(){o&&(o=!1,l.css("cursor","default"),null!==r.mouseup&&r.mouseup())}}),this},e}(),t.fn.dependencyTree=function(s){var i=this instanceof t?this:t(this),n=new e(i,s);return t.data(i[0],"_dependencyTree",n),n}}(jQuery);